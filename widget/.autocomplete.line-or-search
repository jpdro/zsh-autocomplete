#!/bin/zsh
setopt $_autocomplete__options

if [[ $curcontext == history-incremental-search-*:* ]]; then
  zle ${WIDGET%-search}-select -w
elif (( BUFFERLINES == 1 )); then
  local direction='backward'; [[ $WIDGET == up-line-* ]] || direction='forward'
  zle history-search-$direction -w
else
  local tip='beginning'; [[ $WIDGET == up-line-* ]] || tip='end'
  zle .${(M)WIDGET#*-line} || zle .${tip}-of-line
fi
