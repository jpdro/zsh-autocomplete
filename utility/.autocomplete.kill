#!/bin/zsh
emulate -L zsh -o noshortloops -o warncreateglobal -o extendedglob

local -i fd=$1 pid=$2

if (( fd > 9 )) && { true <&$fd } 2> /dev/null; then
  # Close the file descriptor and remove the handler widget.
  exec {fd}<&-
  zle -F $fd 2> /dev/null
fi

if (( pid != 0 )); then
  # Zsh will make a new process group for the child process only if job control is enabled.
  local group='-' && [[ -o MONITOR ]] || group=''
  kill -TERM $group$pid 2> /dev/null
fi
