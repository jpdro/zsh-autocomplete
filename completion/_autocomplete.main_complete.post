#autoload

() {
  zstyle -t ":autocomplete:tab:" insert-unambiguous &&
      (( $#compstate[unambiguous] > $#words[CURRENT] )) &&
    return
  [[ -z $BUFFER ]] &&
    return
  [[ $compstate[old_list] == keep ]] &&
    return
  [[ $curcontext == history-*search*:* ]] &&
    return

  _autocomplete.alias_expansions ||
    _autocomplete.requoted ||
    _autocomplete.unambiguous ||
    _autocomplete.history_lines
}

compstate[list_max]=0
